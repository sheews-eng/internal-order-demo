<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Admin Dashboard</h1>

<table id="adminTable">
  <thead>
    <tr>
      <th>Salesman</th>
      <th>Customer</th>
      <th>Items</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<audio id="orderSound" src="ding.mp3" preload="auto"></audio>

<script type="module">
  import { listenOrders, updateOrderStatus, deleteOrder } from './firebase-script.js';
  const tableBody = document.querySelector('#adminTable tbody');
  const audio = document.getElementById('orderSound');

  function renderOrders(orders) {
    tableBody.innerHTML = '';
    orders.forEach(o => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${o.salesman || 'N/A'}</td>
        <td>${o.customer}</td>
        <td>${o.item} x${o.quantity} ($${o.price})</td>
        <td>${o.status}</td>
        <td>
          ${o.status !== 'Completed' ? `<button data-id="${o.id}" data-status="Completed">Mark Completed</button>` : ''}
          <button data-id="${o.id}" data-status="delete">Delete</button>
        </td>
      `;
      tableBody.appendChild(tr);
    });
  }

  let lastPending = 0;
  listenOrders(orders => {
    renderOrders(orders);

    const pending = orders.filter(o => o.status === 'Pending').length;
    if(pending > lastPending) audio.play();
    lastPending = pending;
  });

  tableBody.addEventListener('click', e => {
    if(e.target.tagName !== 'BUTTON') return;
    const id = e.target.dataset.id;
    const action = e.target.dataset.status;

    if(action === 'delete') deleteOrder(id);
    else updateOrderStatus(id, action);
  });
</script>
</body>
</html>
