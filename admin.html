<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Admin Dashboard</h1>

<button id="enableAudio">Enable Audio</button>
<audio id="orderSound" src="ding.mp3" preload="auto"></audio>

<table id="adminTable">
  <thead>
    <tr>
      <th>Customer</th>
      <th>Items</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script type="module" src="firebase-script.js"></script>
<script type="module">
const audio = document.getElementById('orderSound');
document.getElementById('enableAudio').addEventListener('click', () => {
  audio.play().then(()=>audio.pause());
  document.getElementById('enableAudio').style.display='none';
});

const tableBody = document.querySelector('#adminTable tbody');
let lastPendingCount = 0;

onOrdersChange(orders=>{
  tableBody.innerHTML='';
  const allOrders = Object.entries(orders).map(([id,o])=>({id,...o}));

  allOrders.forEach(o=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${o.customer}</td>
      <td>${o.item} x${o.quantity} ($${o.price})</td>
      <td>${o.status}</td>
      <td>
        ${o.status!=='Completed'?`<button onclick="updateOrderStatus('${o.id}','Completed')">Mark Completed</button>`:''}
      </td>
    `;
    tableBody.appendChild(tr);
  });

  const pendingCount = allOrders.filter(o=>o.status==='Pending').length;
  if(pendingCount>lastPendingCount) audio.play();
  lastPendingCount = pendingCount;
});
</script>
</body>
</html>
